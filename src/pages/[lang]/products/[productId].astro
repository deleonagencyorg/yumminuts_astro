---
// src/pages/[lang]/productos/[productId].astro
import { t, setLocale, type Locale } from '../../../i18n/i18n';
import MainLayout from '../../../layouts/MainLayout.astro';
import SEO from '../../../components/SEO.astro';
import ProductDetail from '../../../views/Products/Detail/index.astro';

export function getStaticPaths() {
  // Obtener todos los idiomas y productos disponibles
  const locales = ['en'];
  const paths = [];

  for (const locale of locales) {
    // Obtener productos para este idioma
    const products = t('items', { namespace: 'products', locale: locale as Locale }) || [];
    
    // Para cada producto, crear una ruta
    for (const product of products) {
      paths.push({
        params: { lang: locale, productId: product.id },
        props: { product, currentLang: locale as Locale }
      });
    }
  }

  console.log(`Generadas ${paths.length} rutas de productos en espa√±ol`);
  return paths;
}

const { product, currentLang } = Astro.props;
const { lang, productId } = Astro.params;

// Establecer el idioma para las traducciones
setLocale(lang as Locale);

---

<MainLayout title={product.name}>
  <Fragment slot="head">
    <SEO 
      currentLang={currentLang}
      title={product.name}
      description={product.description || product.name}
      canonicalUrl={`https://snacksyummies.com/${currentLang}/products/${product.id}`}
      imageUrl={(product.image || (product.sizes && product.sizes[0]?.image) || 'https://snack.yummiespromociones.com/snacksyummies/yumminuts-producto.webp')}
    />
  </Fragment>
  <ProductDetail currentLang={currentLang} productId={productId} />
</MainLayout>
