---
import LazyImage from '../common/LazyImage.astro';
import RecipePlaceholder from './RecipePlaceholder.astro';
import { getLocale } from '../../i18n/i18n';
import { Image } from 'astro:assets';
import { fade } from 'astro:transitions';

interface Props {
  image?: string;
  title: string;
  time?: string;
  id: string;
  textColor?: string;
  iconColor?: string;
  hoverImage?: string;
  difficulty?: string;
  servings?: number;
  rating?: number;
  isMainCard?: boolean;
}

const { 
  image, 
  title, 
  time = "---", 
  id,
  textColor = 'text-blue-900',
  iconColor = 'text-blue-900',
  hoverImage = image,
  difficulty = "---",
  servings = 0,
  rating = 0,
  isMainCard = false
} = Astro.props;

const currentLocale = getLocale();
const recipeLink = `/${currentLocale}/${currentLocale === 'es' ? 'recetas' : 'recipes'}/${id}`;
const viewRecipeText = currentLocale === 'es' ? 'Ver Receta' : 'View Recipe';

// Verificar si la imagen es válida (no es placeholder ni está vacía)
const hasValidImage = image && !image.includes('placeholder.jpg');
---

<a 
  href={recipeLink} 
  class="block group relative transition-all duration-300 ease-in-out w-full"
  transition:animate="fade"
>
  <!-- Contenedor principal con altura uniforme -->
  <div class="flex flex-col relative w-full">
    <!-- Imagen con tamaño uniforme y background-size: cover (via object-cover) -->
    <div class="relative overflow-hidden w-full aspect-[4/3] rounded-xl">
      {hasValidImage ? (
        <LazyImage
          src={image}
          alt={title}
          class="w-full h-full object-cover"
          transition:name={`recipe-image-${id}`}
        />
      ) : (
        <RecipePlaceholder
          class="w-full h-full rounded-xl"
        />
      )}
    </div>
    
    <!-- Información con altura fija para alinear cards -->
    <div class="pt-2 md:pt-3 h-[64px] md:h-[72px]">
      <!-- Título: envuelve y no desborda; máximo 2 líneas -->
      <h3 class="font-sans font-bold text-black text-sm md:text-xl leading-snug mt-2 break-words overflow-hidden line-clamp-2">{title}</h3>
    </div>
  </div>
</a>
